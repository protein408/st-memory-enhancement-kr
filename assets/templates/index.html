<div class="memory_enhancement_container">
    <div class="memory_enhancement_settings">
        <div class="inline-drawer">
            <div id="inline_drawer_header_content">
                <b style="font-size: 1.1rem" data-i18n="Memory Enhancement (Tables)">메모리 향상 테이블</b>
                <span id="tableUpdateTag" style="cursor: pointer; background-color: #41b68188"
                    data-i18n="Click to update">Click to update</span>
            </div>

            <div class="inline-drawer-content">
                <div id="memory_enhancement_settings_inline_drawer_content">
                    <!-- 메모리 향상 테이블 관리 -->
                    <div style=" display: flex; flex-direction: row; justify-content: space-between; ">
                        <div style=" display: flex; flex-direction: row; gap: 10px;">
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-brands fa-github fa-lg"></i>
                                <a href="https://github.com/protein408/st-memory-enhancement-kr/"
                                    data-i18n="Project link">프로젝트 주소</a>
                            </div>
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-solid fa-book"></i>
                                <a href="https://muyoo.com.cn/wiki/memory/start.html" data-i18n="Read tutorial">튜토리얼 읽기</a>
                            </div>
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-solid fa-list"></i>
                                <a href="https://github.com/muyoou/st-memory-enhancement/releases"
                                    data-i18n="Changelog">업데이트 로그</a>
                            </div>
                        </div>
                        <div class="menu_button_icon menu_button interactable" id="table_debug_log_button">
                            <i class="fa-solid fa-bug"></i>
                            <a data-i18n="Logs">Log</a>
                        </div>
                    </div>
                    <div id="table_message_tip"></div>


                    <!--                        <hr/>-->

                    <!-- 하위 설정 -->
                    <div class="persona_management_left_column flex-container wide100p flexGap10"
                        style="padding: 10px 0; gap: 10px">
                        <div class="flex1 wide50p" style="min-width: 300px">
                            <h4 class="standoutHeader" data-i18n="Plugin settings">플러그인 설정</h4>

                            <!-- 기본 설정 -->
                            <div>
                                <h4 class="standoutHeader flex-container wide100p"
                                    style="justify-content: space-between; align-items: center">
                                    <div data-i18n="Import, export and reset plugin">플러그인 가져오기, 내보내기 및 재설정</div>
                                    <div class="flex-container">
                                        <div class="menu_button button-square-icon fa-solid fa-file-import"
                                            id="table-set-import" title="표 설정 가져오기"
                                            data-i18n="[title]Import table presets"></div>
                                        <!--                                        <input type="file" id="table-set-importFile" accept=".json" hidden>-->
                                        <div class="menu_button button-square-icon fa-solid fa-file-export"
                                            id="table-set-export" title="표 설정 내보내기"
                                            data-i18n="[title]Export table presets"></div>
                                        <div class="menu_button button-square-icon fa-solid fa-undo" id="table-reset"
                                            title="표 프리셋 재설정" data-i18n="[title]Reset table presets"></div>
                                    </div>
                            </div>

                            <h4 data-i18n="Plugin switches">플러그인 스위치</h4>
                            <div class="checkbox_label range-block justifyLeft">
                                <input type="checkbox" id="table_switch"><span data-i18n="Enable plugin">플러그인 활성화</span>
                            </div>
                            <!--                                <div class="checkbox_label">-->
                            <!--                                    <input type="checkbox" id="table_switch_creator_mode"><span>创作者模式</span>-->
                            <!--                                </div>-->
                            <div class="checkbox_label range-block justifyLeft">
                                <input type="checkbox" id="table_switch_debug_mode"><span
                                    data-i18n="Debug mode">디버그 모드</span>
                                <small class="toggle-description justifyLeft"
                                    data-i18n="Debug mode description">(활성화하면 성능 저하가 발생할 수 있으며, 코드 개발 및 디버깅에만 사용됩니다)</small>
                            </div>

                            <h4 data-i18n="Message template">메시지 템플릿</h4>
                            <div style="padding-left: 5px;">
                                <label for="dataTable_message_template"></label>
                                <small class="toggle-description justifyLeft"
                                    data-i18n="Message template description">(AI에게 테이블 사용법과 수정법을 설명하는 데 사용되며, <code>{{tableData}}</code>매크로 명령을 사용하여 테이블 데이터 삽입 위치를 선택)</small>
                                <textarea id="dataTable_message_template" class="wide100p" rows="8"></textarea>
                            </div>
                            <!-- 고급 설정 옵션 -->
                            <div style="padding-left: 5px;">
                                <div style="display: flex; align-items: center;">
                                    <label for="dataTable_injection_mode" style="min-width: 50px"
                                        data-i18n="Injection">삽입:</label>
                                    <select id="dataTable_injection_mode">
                                        <option value="injection_off" data-i18n="Turn off injection">삽입 끄기
                                        </option>
                                        <option value="deep_system">@D ⚙</option>
                                        <option value="deep_user">@D 👤</option>
                                        <option value="deep_assistant">@D 🤖</option>
                                    </select>
                                    <label for="dataTable_deep" style="min-width: 60px; padding-left: 10px;"
                                        data-i18n="Depth">깊이:</label>
                                    <input id="dataTable_deep" class="text_pole" type="number">
                                </div>
                            </div>
                        </div>
                        <div class="flex1 wide50p" style="min-width: 300px">
                            <!-- 表格预设 -->
                            <div>
                                <!-- 프리셋 설정 -->
                                <h4 class="standoutHeader" data-i18n="Run strategy">실행 전략</h4>
                                <label for="fill_table_time" data-i18n="Render to">테이블 채우기 작업 발생 시점：</label>
                                <select id="fill_table_time" class="flex1" style="min-width: 100px">
                                    <option value="chat">채팅과 동시에 테이블 채우기</option>
                                    <option value="after">메시지 수신 후 별도로 테이블 채우기</option>
                                </select>


                                <!-- 기본적으로 단계별 테이블 채우기 안 함 -->
                                <div id="reply_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <!-- 단계별 테이블 채우기 -->
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="table_read_switch"><span
                                            data-i18n="AI read table switch">AI 표 읽기 버튼</span>
                                    </div>
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="table_edit_switch"><span
                                            data-i18n="AI edit table switch">AI 표 수정 버튼</span>
                                    </div>
                                </div>

                                <!-- 단계별 테이블 채우기 -->
                                <div id="step_by_step_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <div class="checkbox_label" style="display: flex; align-items: center;">
                                        <input type="checkbox" id="step_by_step_use_main_api" checked><span
                                            data-i18n="Use main API">메인 API 사용</span>
                                        <div class="menu_button menu_button_icon" id="trigger_step_by_step_button"
                                            style="margin-left: 10px;">
                                            <i class="fa-solid fa-play"></i><a data-i18n="Fill now">지금 표 채우기</a>
                                        </div>
                                        <label for="separateReadContextLayers" style="margin-left: 10px;">컨텍스트 레이어 수</label>
                                        <input type="number" id="separateReadContextLayers" class="margin0 text_pole"
                                            style="width: 50px;" min="1" value="1" />
                                        <label for="separateReadLorebook" style="margin-left: 10px;">월드북 읽기</label>
                                        <input type="checkbox" id="separateReadLorebook" class="margin0" />
                                        <small class="toggle-description justifyLeft">(대용량 토큰 카드 사용 권장하지 않음)</small>
                                    </div>
                                    <div style="padding-left: 5px; margin-bottom: 10px;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <label for="step_by_step_user_prompt"
                                                data-i18n="settings.label.stepByStepUserPrompt">독립 테이블 채우기 전체 구조</label>
                                            <div class="menu_button button-square-icon fa-solid fa-undo"
                                                id="reset_step_by_step_user_prompt" title="기본값으로 재설정"
                                                data-i18n="[title]Reset to default"></div>
                                        </div>
                                        <small class="toggle-description justifyLeft"
                                            data-i18n="settings.hint.stepByStepUserPrompt">(독립 테이블 채우기 시, 요청이 이 구조로 전송됩니다. JSON 파싱 가능하도록 유지하세요)</small>
                                        <textarea id="step_by_step_user_prompt"
                                            class="text_pole settings_textarea wide100p" rows="8"
                                            placeholder="输入独立填表提示词"></textarea>
                                    </div>
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="confirm_before_execution" checked><span
                                            data-i18n="Confirm before execution">실행 시 확인</span>
                                        <small class="toggle-description justifyLeft"
                                            data-i18n="Confirm before execution description">(독립 테이블 채우기 과정에서 검사 노드를 만나면 확인 대화상자가 표시됩니다)</small>
                                    </div>

                                    <div class="inline-drawer wide100p">
                                        <div class="inline-drawer-toggle inline-drawer-header">
                                            <b><span data-i18n="Custom independent API">커스텀 독립 API</span></b>
                                            <div class="fa-solid fa-circle-chevron-down inline-drawer-icon down"></div>
                                        </div>
                                        <div class="inline-drawer-content"
                                            style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                            <!-- 自定义API设置 -->
                                            <input type="text" id="custom_api_url" class="text_pole"
                                                placeholder="API URL（请以/v1结尾）">
                                            <input type="password" id="custom_api_key" class="text_pole"
                                                placeholder="API Key(多个key用逗号隔开)">
                                            <input type="text" id="custom_model_name" class="text_pole"
                                                placeholder="Model Name（模型名称，可手动输入或自动获取）">
                                            <div class="range-block justifyLeft">
                                                <select id="model_selector" class="text_pole">
                                                    <option value="">请先获取模型列表</option>
                                                </select>
                                                <div class="menu_button menu_button_icon" id="fetch_models_button">
                                                    <a>获取模型列表</a>
                                                </div>
                                                <div class="menu_button menu_button_icon" id="table_test_api_button"
                                                    style="margin-left: 5px;">
                                                    <a>测试</a>
                                                </div>
                                            </div>
                                            <div class="flex-container slider-container"
                                                style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                                <label
                                                    style="min-width: 140px; margin: 0; white-space: nowrap; flex-shrink: 0;"
                                                    data-i18n="Custom API temperature setting">自定义API温度设定：<span
                                                        id="custom_temperature_value">1.0</span></label>
                                                <input type="range" id="custom_temperature" min="0.1" max="2.0"
                                                    step="0.1" value="1.0" style="flex-grow: 1;">
                                            </div>

                                            <!-- 代理设置 -->
                                            <div class="inline-drawer wide100p">
                                                <div class="inline-drawer-toggle inline-drawer-header">
                                                    <b><span data-i18n="Proxy settings">代理设置<span
                                                                style="color: red">(未完成，不能用，请留空)</span></b>
                                                    <div class="fa-solid inline-drawer-icon interactable up fa-circle-chevron-up"
                                                        tabindex="0"></div>
                                                </div>
                                                <div class="inline-drawer-content"
                                                    style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                                    <input type="text" id="table_proxy_address" class="text_pole"
                                                        placeholder="代理地址 (例如：http://127.0.0.1:7890)"
                                                        data-i18n="[placeholder]Proxy address (e.g., http://127.0.0.1:7890)">
                                                    <input type="password" id="table_proxy_key" class="text_pole"
                                                        placeholder="代理密钥 (可选)"
                                                        data-i18n="[placeholder]Proxy key (optional)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 테이블 재정리 -->
                            <div class="inline-drawer wide100p">
                                <div class="inline-drawer-toggle inline-drawer-header">
                                    <b><span data-i18n="Reorganize tables">테이블 요약/정리</span></b>
                                    <div class="fa-solid fa-circle-chevron-down inline-drawer-icon down"></div>
                                </div>
                                <div class="inline-drawer-content" style="display: none; ">
                                    <div class="checkbox_label" range-block justifyLeft>
                                        <input type="checkbox" id="use_main_api" checked><span
                                            data-i18n="Use main API">메인 API 사용</span>
                                    </div>

                                    <!-- 고급 설정 옵션 -->
                                    <!-- <div class="flex-container slider-container" style="margin: 5px; padding-bottom: 10px;" id="clear_up_stairs_container">
                                        <label><span data-i18n="Reference recent chat history">최근 채팅 기록 참조：</span><code id="clear_up_stairs_value">9항목</code></label>
                                        <input type="range" id="clear_up_stairs" min="1" max="99" step="1" value="9" style="width: calc(100% - 20px);">
                                    </div> -->
                                    <div class="flex-container slider-container"
                                        style="margin: 5px; padding-bottom: 10px" id="token_limit_container">
                                        <label><span data-i18n="Token limit">토큰 제한：</span><code
                                                id="rebuild_token_limit_value">10000</code></label>
                                        <input type="range" id="rebuild_token_limit" min="1000" max="100000" step="1000"
                                            value="10000" style="width: calc(100% - 20px);">
                                    </div>
                                    <!-- 차단 옵션을 기본 토큰 제한으로 변경 -->
                                    <!-- <div class="checkbox_label">
                                        <input type="checkbox" id="use_token_limit"><span data-i18n="Use token limit instead of chat history limit">채팅 기록 제한을 토큰 기준으로 대체</span>
                                    </div> -->
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="ignore_user_sent" checked><span
                                            data-i18n="Only reference AI replies">AI 응답 메시지만 참조</span>
                                    </div>
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="bool_silent_refresh"><span
                                            data-i18n="Skip confirmation dialog after reorganizing">요약 후 확인 팝업 건너뛰기</span>
                                    </div>

                                    <div class="flex-container" style="flex-wrap: nowrap; padding-top: 10px;">
                                        <b style="width: 170px;">요약 템플릿</b>
                                        <select id="rebuild--select">
                                        </select>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-pencil"
                                            id="rebuild--set-rename" title="요약 템플릿 편집"></div>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-plus"
                                            id="rebuild--set-new" title="요약 템플릿 생성"></div>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-file-import"
                                            id="rebuild--set-import" title="요약 템플릿 가져오기"></div>
                                        <input type="file" id="rebuild--set-importFile" accept=".json" hidden>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-file-export"
                                            id="rebuild--set-export" title="요약 템플릿 내보내기"></div>
                                        <div class="rebuild--del menu_button menu_button_icon fa-solid fa-trash redWarningBG"
                                            id="rebuild--set-delete" title="이 템플릿 삭제"></div>
                                    </div>

                                    <div style="display: flex; width: calc(100% - 20px);">
                                        <div class="menu_button menu_button_icon" id="table_clear_up">
                                            <i class="fa-solid fa-repeat"></i><a
                                                data-i18n="Reorganize tables now">지금 테이블 정리</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--                        <hr/>-->

                            <!-- 테이블을 대화로 푸시 -->
                            <div class="flex1 wide100p">
                                <h4 class="standoutHeader" data-i18n="Frontend table (status bar)">프론트엔드 테이블 (상태 표시줄)</h4>
                                <!--                            <b class="table_setting_category_header">표를 대화창에 전송</b><div style="height: 10px;"></div>-->
                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="show_settings_in_extension_menu" checked><span
                                        data-i18n="Access tables from extensions menu">확장 메뉴에서 테이블 접근</span>
                                </div>
                                <!--                                <div class="checkbox_label range-block justifyLeft unfinished">-->
                                <!--                                    <input type="checkbox" id="show_drawer_in_extension_list" checked><span>확장 목록에서 표 설정 표시</span>-->
                                <!--                                </div>-->

                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="table_to_chat"><span
                                        data-i18n="Render table view in conversation">테이블 뷰를 대화에 렌더링</span>
                                    <small class="toggle-description justifyLeft"
                                        data-i18n="Render table view in conversation description">(활성화 시 대화 상자에 사용자 정의 테이블을 표시합니다)</small>
                                </div>

                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="alternate_switch" checked><span
                                        data-i18n="Render table view in alternate model">교대(alternate) 모드</span>
                                    <small class="toggle-description justifyLeft"
                                        data-i18n="Render table view in alternate model description">(활성화 시 대화 상자에서 교대 렌더링 모드를 활성화합니다)</small>
                                </div>


                                <!-- 테이블을 대화로 푸시 -->
                                <div id="table_to_chat_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <!-- TODO 여기에서는 다음 기능이 필요<div class="checkbox_label range-block justifyLeft unfinished">
                                        <input type="checkbox" id="table_to_chat_can_edit"><span data-i18n="Data editable">데이터 편집 가능</span>
                                        <small class="toggle-description justifyLeft" data-i18n="Data editable description">(대화에 렌더링된 테이블의 데이터를 편집할 수 있습니다)</small>
                                    </div> -->

                                    <div class="checkbox_label range-block justifyLeft">
                                        <label for="table_to_chat_mode" data-i18n="Render to">렌더링 위치</label>
                                        <select id="table_to_chat_mode" class="flex1" style="min-width: 100px">
                                            <option value="context_bottom" data-i18n="Bottom of context">컨텍스트 하단
                                            </option>
                                            <option value="last_message" data-i18n="Inside last message">마지막 메시지 내부
                                            </option>
                                            <!--                                            <option value="macro">자정의 위치（매크로）</option>-->
                                        </select>
                                        <small id="table_to_chat_is_micro_d" class="toggle-description justifyLeft"
                                            data-i18n="Use custom display location"><code>{{sheetsView}}</code>
                                            사용자 정의 보기 위치 사용</small>
                                    </div>

                                    <div class="menu_button menu_button_icon" id="dataTable_to_chat_button"
                                        style="margin-top: 10px">
                                        <i class="fa-solid fa-wand-magic-sparkles"></i><a
                                            data-i18n="Edit style of tables rendered in conversation">채팅에 렌더링된 테이블 스타일 편집</a>
                                    </div>
                                </div>

                                <!-- 고급 설정 -->
                                <div class="inline-drawer wide100p">
                                    <div class="inline-drawer-toggle inline-drawer-header">
                                        <b><span data-i18n="Advanced rendering settings">고급 렌더링 설정</span></b>
                                        <div class="fa-solid fa-circle-chevron-down inline-drawer-icon down">
                                        </div>
                                    </div>
                                    <div class="inline-drawer-content"
                                        style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                        <!-- 고급 설정 옵션 -->
                                        <div class="checkbox_label range-block justifyLeft">
                                            <label for="table_cell_width_mode" data-i18n="Render to">셀 표시</label>
                                            <select id="table_cell_width_mode" class="flex1" style="min-width: 100px">
                                                <option value="single_line">줄바꿈 없음</option>
                                                <option value="wide1_cell">넓게</option>
                                                <option value="wide1_2_cell">반 너비</option>
                                                <option value="wide1_4_cell">1/4 너비</option>
                                            </select>
                                            <small id="table_to_chat_is_micro_d"
                                                class="toggle-description justifyLeft">모든 위치의 테이블 셀 표시 방식</small>
                                        </div>
                                        <div class="checkbox_label range-block justifyLeft">
                                            <input type="checkbox" id="high_performance_sheets_render"><span
                                                data-i18n="Disable dynamic effects in table plugin">테이블 플러그인 내 동적 효과 비활성화</span>
                                            <small class="toggle-description justifyLeft"
                                                data-i18n="Disable dynamic effects description">(플러그인 활성화 후 실행 시 버벅임이 발생하면 이 옵션을 켜보세요)</small>
                                        </div>
                                        <div class="checkbox_label range-block justifyLeft">
                                            <input type="checkbox" id="gpu_assist_sheets_render"><span
                                                data-i18n="Disable GPU table rendering">GPU 테이블 렌더링 비활성화</span>
                                            <small class="toggle-description justifyLeft"
                                                data-i18n="Disable GPU table rendering description">(GPU 테이블 렌더링 수동 비활성화)</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>